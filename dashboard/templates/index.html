<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kicks: Adidas US Sales Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <!-- Plotly -->
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@latest/plotly.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-dark sticky-top shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('sales.index') }}">
                <i class="fas fa-running me-2"></i>
                <span class="brand-text">KICKS</span>
                <span class="brand-subtitle">Adidas US Sales Analytics</span>
            </a>
            <div class="text-white">
                {% if kpis.start_date and kpis.end_date %}
                <small><i class="far fa-calendar-alt me-2"></i>{{ kpis.start_date }} - {{ kpis.end_date }}</small>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">

        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="dashboard-header">
                    <h1 class="display-5 fw-bold mb-2">
                        <i class="fas fa-chart-line me-3"></i>Sales Performance Dashboard
                    </h1>
                    <p class="lead text-muted">Comprehensive analytics for Adidas US sales</p>
                </div>
            </div>
        </div>

        <!-- CORRECTED: Tabs Navigation as Links -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'sales-overview' %}active{% endif %}" href="{{ url_for('sales.index') }}">Sales Overview</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'customer-patterns' %}active{% endif %}" href="{{ url_for('customer.index') }}">Customer Patterns</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'product-analysis' %}active{% endif %}" href="{{ url_for('product.index') }}">Product Analysis</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'about' %}active{% endif %}" href="{{ url_for('about.index') }}">About</a>
            </li>
        </ul>

        <!-- CORRECTED: Content area with conditional rendering -->
        <div class="content-area pt-4">
            
            {% if active_tab == 'sales-overview' %}
            <!-- Sales Overview Content -->
            <div id="sales-overview">
                <!-- KPI Cards -->
                <div class="row g-3 mb-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-primary"><i class="fas fa-dollar-sign"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Total Sales</h6>
                                <h2 class="kpi-value">{{ kpis.total_sales }}</h2>
                                <p class="kpi-description">Gross revenue generated</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-success"><i class="fas fa-hand-holding-usd"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Operating Profit</h6>
                                <h2 class="kpi-value">{{ kpis.total_profit }}</h2>
                                <p class="kpi-description">Total profit earned</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-info"><i class="fas fa-shopping-cart"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Units Sold</h6>
                                <h2 class="kpi-value">{{ kpis.total_units }}</h2>
                                <p class="kpi-description">Total products sold</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-warning"><i class="fas fa-percentage"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Avg Margin</h6>
                                <h2 class="kpi-value">{{ kpis.avg_margin }}</h2>
                                <p class="kpi-description">Average profit margin</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Rows for Sales Overview -->
                <div class="row g-3 mb-4">
                    <div class="col-lg-8"><div class="chart-card interactive-chart" data-chart="sales-trend-chart"><div id="sales-trend-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-4"><div class="chart-card interactive-chart" data-chart="region-chart"><div id="region-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="product-chart"><div id="product-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="retailer-chart"><div id="retailer-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-4"><div class="chart-card interactive-chart" data-chart="sales-method-chart"><div id="sales-method-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-8"><div class="chart-card interactive-chart" data-chart="top-states-chart"><div id="top-states-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="margin-chart"><div id="margin-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="quarterly-chart"><div id="quarterly-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-12"><div class="chart-card interactive-chart" data-chart="price-distribution-chart"><div id="price-distribution-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
            </div>
            
            {% elif active_tab == 'customer-patterns' %}
            <!-- Customer Patterns Content -->
            <div id="customer-patterns">
                <div class="row g-3 mb-4">
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="sales-by-retailer-chart"><div id="sales-by-retailer-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="sales-by-sales-method-chart"><div id="sales-by-sales-method-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-12"><div class="chart-card interactive-chart" data-chart="sales-by-state-chart"><div id="sales-by-state-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-12"><div class="chart-card interactive-chart" data-chart="sales-by-day-of-week-chart"><div id="sales-by-day-of-week-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
            </div>
            
            {% elif active_tab == 'product-analysis' %}
            <!-- Product Analysis Content -->
            <div id="product-analysis">
                <!-- Product KPI Cards -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-primary"><i class="fas fa-box"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Product Categories</h6>
                                <h2 class="kpi-value">{{ kpis.num_products }}</h2>
                                <p class="kpi-description">Total product lines</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-success"><i class="fas fa-chart-line"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Total Revenue</h6>
                                <h2 class="kpi-value">{{ kpis.total_sales }}</h2>
                                <p class="kpi-description">All products combined</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-info"><i class="fas fa-cubes"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Units Sold</h6>
                                <h2 class="kpi-value">{{ kpis.total_units }}</h2>
                                <p class="kpi-description">Total items sold</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-warning"><i class="fas fa-percentage"></i></div>
                            <div class="kpi-content">
                                <h6 class="kpi-label">Avg Margin</h6>
                                <h2 class="kpi-value">{{ kpis.avg_margin }}</h2>
                                <p class="kpi-description">Product profitability</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Charts -->
                <div class="row g-3 mb-4">
                    <div class="col-lg-12"><div class="chart-card interactive-chart" data-chart="product-revenue-profit-chart"><div id="product-revenue-profit-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="product-profitability-matrix-chart"><div id="product-profitability-matrix-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="product-by-sales-channel-chart"><div id="product-by-sales-channel-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-12"><div class="chart-card interactive-chart" data-chart="product-sales-trend-chart"><div id="product-sales-trend-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
                <div class="row g-3 mb-4">
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="product-price-distribution-chart"><div id="product-price-distribution-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                    <div class="col-lg-6"><div class="chart-card interactive-chart" data-chart="product-regional-mix-chart"><div id="product-regional-mix-chart" class="chart-container"></div><div class="chart-overlay"><i class="fas fa-expand-alt"></i><span>Click to view details</span></div></div></div>
                </div>
            </div>

            {% elif active_tab == 'about' %}
            <!-- About Content -->
            <div id="about">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <!-- Project Overview Card -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <i class="fas fa-info-circle fa-3x text-primary mb-3"></i>
                                    <h2 class="fw-bold mb-2">About This Dashboard</h2>
                                    <p class="text-muted">Comprehensive Analytics for Adidas US Sales Performance</p>
                                </div>

                                <div class="row mt-5">
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex align-items-start">
                                            <div class="me-3">
                                                <i class="fas fa-chart-bar fa-2x text-info"></i>
                                            </div>
                                            <div>
                                                <h5 class="fw-bold">Interactive Visualizations</h5>
                                                <p class="text-muted">19+ dynamic charts powered by Plotly providing deep insights into sales trends, customer patterns, and product performance.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex align-items-start">
                                            <div class="me-3">
                                                <i class="fas fa-database fa-2x text-success"></i>
                                            </div>
                                            <div>
                                                <h5 class="fw-bold">Real Data Analysis</h5>
                                                <p class="text-muted">Built on 9,648 real Adidas sales transactions spanning 2020-2021 across 6 retailers and 50 US states.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex align-items-start">
                                            <div class="me-3">
                                                <i class="fas fa-code fa-2x text-warning"></i>
                                            </div>
                                            <div>
                                                <h5 class="fw-bold">Modern Tech Stack</h5>
                                                <p class="text-muted">Flask backend with Pandas data processing, Plotly visualizations, and Bootstrap 5 responsive design.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex align-items-start">
                                            <div class="me-3">
                                                <i class="fas fa-cloud fa-2x text-danger"></i>
                                            </div>
                                            <div>
                                                <h5 class="fw-bold">Cloud Deployment</h5>
                                                <p class="text-muted">Fully configured for Vercel serverless deployment with auto-scaling and global CDN distribution.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Researchers Card -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <i class="fas fa-users fa-3x text-success mb-3"></i>
                                    <h2 class="fw-bold mb-2">Research Team</h2>
                                    <p class="text-muted">Developed and maintained by</p>
                                </div>

                                <div class="row mt-4">
                                    <div class="col-md-6 mb-4">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center p-4">
                                                <div class="mb-3">
                                                    <i class="fas fa-user-circle fa-4x text-primary"></i>
                                                </div>
                                                <h4 class="fw-bold mb-2">Theo Benedict Pasia</h4>
                                                <p class="text-muted mb-0">Researcher & Developer</p>
                                                <div class="mt-3">
                                                    <span class="badge bg-primary me-2">Data Analysis</span>
                                                    <span class="badge bg-info">Dashboard Design</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="card border-0 bg-light h-100">
                                            <div class="card-body text-center p-4">
                                                <div class="mb-3">
                                                    <i class="fas fa-user-circle fa-4x text-success"></i>
                                                </div>
                                                <h4 class="fw-bold mb-2">Kent Paulo Delgado</h4>
                                                <p class="text-muted mb-0">Researcher & Developer</p>
                                                <div class="mt-3">
                                                    <span class="badge bg-success me-2">Backend Development</span>
                                                    <span class="badge bg-warning text-dark">Data Processing</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dataset Card -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <i class="fab fa-kaggle fa-3x text-info mb-3"></i>
                                    <h2 class="fw-bold mb-2">Dataset Information</h2>
                                    <p class="text-muted">Source & Specifications</p>
                                </div>

                                <div class="alert alert-info d-flex align-items-center" role="alert">
                                    <i class="fas fa-info-circle fa-2x me-3"></i>
                                    <div>
                                        <h5 class="alert-heading mb-2">Adidas Sales Dataset</h5>
                                        <p class="mb-2">This dashboard analyzes the <strong>Adidas Sales Dataset</strong> publicly available on Kaggle.</p>
                                        <a href="https://www.kaggle.com/datasets/heemalichaudhari/adidas-sales-dataset" target="_blank" class="btn btn-info btn-sm">
                                            <i class="fab fa-kaggle me-2"></i>View Dataset on Kaggle
                                        </a>
                                    </div>
                                </div>

                                <div class="row mt-4">
                                    <div class="col-md-3 col-6 mb-3 text-center">
                                        <div class="border rounded p-3">
                                            <h3 class="fw-bold text-primary mb-1">9,648</h3>
                                            <p class="text-muted small mb-0">Transactions</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6 mb-3 text-center">
                                        <div class="border rounded p-3">
                                            <h3 class="fw-bold text-success mb-1">6</h3>
                                            <p class="text-muted small mb-0">Retailers</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6 mb-3 text-center">
                                        <div class="border rounded p-3">
                                            <h3 class="fw-bold text-info mb-1">50</h3>
                                            <p class="text-muted small mb-0">US States</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6 mb-3 text-center">
                                        <div class="border rounded p-3">
                                            <h3 class="fw-bold text-warning mb-1">2020-21</h3>
                                            <p class="text-muted small mb-0">Time Period</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <h5 class="fw-bold mb-3">Dataset Features:</h5>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>6 Product Categories (Men's & Women's Footwear, Apparel)</li>
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>3 Sales Channels (In-store, Outlet, Online)</li>
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>5 Geographic Regions across the United States</li>
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Complete financial metrics (Sales, Profit, Margin, Units)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Technology Stack Card -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <i class="fas fa-laptop-code fa-3x text-warning mb-3"></i>
                                    <h2 class="fw-bold mb-2">Technology Stack</h2>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-server me-2 text-primary"></i>Backend</h5>
                                        <ul class="list-unstyled ms-3">
                                            <li class="mb-2">Flask 3.0 - Web Framework</li>
                                            <li class="mb-2">Pandas 2.0 - Data Processing</li>
                                            <li class="mb-2">NumPy 1.24 - Numerical Computing</li>
                                            <li class="mb-2">Plotly 5.18 - Visualizations</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-palette me-2 text-success"></i>Frontend</h5>
                                        <ul class="list-unstyled ms-3">
                                            <li class="mb-2">Bootstrap 5.3 - UI Framework</li>
                                            <li class="mb-2">Plotly.js - Chart Rendering</li>
                                            <li class="mb-2">Font Awesome 6.4 - Icons</li>
                                            <li class="mb-2">Google Fonts - Typography</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% endif %}
        </div>

        <!-- Footer -->
        <footer class="row mt-5 mb-4">
            <div class="col-12">
                <div class="dashboard-footer text-center">
                    <p class="text-muted mb-1"><i class="fas fa-database me-2"></i>Dashboard powered by Flask, Plotly, and Bootstrap</p>
                    <p class="text-muted small"><i class="far fa-copyright me-1"></i> 2024 Kicks Analytics | Adidas US Sales Dashboard</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Chart Info Modal -->
    <div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title" id="chartModalLabel"><i class="fas fa-chart-line me-2"></i><span id="modalChartTitle">Chart Details</span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="chart-preview-container" id="modalChartPreview">
                                <!-- Chart will be rendered here -->
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="chart-info-panel">
                                <h6 class="fw-bold mb-3"><i class="fas fa-info-circle me-2 text-primary"></i>Chart Information</h6>
                                <div id="chartInfoContent">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times me-2"></i>Close</button>
                    <button type="button" class="btn btn-primary" onclick="downloadChart()"><i class="fas fa-download me-2"></i>Download Chart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check which tab is active and load content accordingly
            const activeTab = "{{ active_tab }}";
            if (activeTab === 'sales-overview') {
                loadAllSalesCharts();
            } else if (activeTab === 'customer-patterns') {
                loadCustomerCharts();
            } else if (activeTab === 'product-analysis') {
                loadProductCharts();
            }
        });

        async function loadAllSalesCharts() {
            try {
                await Promise.all([
                    loadChart('/api/sales-trend', 'sales-trend-chart'),
                    loadChart('/api/sales-by-region', 'region-chart'),
                    loadChart('/api/product-performance', 'product-chart'),
                    loadChart('/api/retailer-performance', 'retailer-chart'),
                    loadChart('/api/sales-method', 'sales-method-chart'),
                    loadChart('/api/top-states', 'top-states-chart'),
                    loadChart('/api/margin-analysis', 'margin-chart'),
                    loadChart('/api/quarterly-performance', 'quarterly-chart'),
                    loadChart('/api/price-distribution', 'price-distribution-chart')
                ]);
                console.log('All sales charts loaded successfully!');
            } catch (error) {
                console.error('Error loading sales charts:', error);
            }
        }

        async function loadCustomerCharts() {
            try {
                await Promise.all([
                    loadChart('{{ url_for('api.sales_by_retailer') }}', 'sales-by-retailer-chart'),
                    loadChart('{{ url_for('api.sales_by_sales_method') }}', 'sales-by-sales-method-chart'),
                    loadChart('{{ url_for('api.sales_by_state') }}', 'sales-by-state-chart'),
                    loadChart('{{ url_for('api.sales_by_day_of_week') }}', 'sales-by-day-of-week-chart')
                ]);
                console.log('All customer charts loaded successfully!');
            } catch (error) {
                console.error('Error loading customer charts:', error);
            }
        }

        async function loadProductCharts() {
            try {
                await Promise.all([
                    loadChart('{{ url_for('api.product_revenue_profit') }}', 'product-revenue-profit-chart'),
                    loadChart('{{ url_for('api.product_profitability_matrix') }}', 'product-profitability-matrix-chart'),
                    loadChart('{{ url_for('api.product_by_sales_channel') }}', 'product-by-sales-channel-chart'),
                    loadChart('{{ url_for('api.product_price_distribution') }}', 'product-price-distribution-chart'),
                    loadChart('{{ url_for('api.product_sales_trend') }}', 'product-sales-trend-chart'),
                    loadChart('{{ url_for('api.product_regional_mix') }}', 'product-regional-mix-chart')
                ]);
                console.log('All product charts loaded successfully!');
            } catch (error) {
                console.error('Error loading product charts:', error);
            }
        }

        async function loadChart(apiUrl, chartId) {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const config = { responsive: true, displayModeBar: true, displaylogo: false, modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'] };
                Plotly.newPlot(chartId, data.data, data.layout, config);
            } catch (error) {
                console.error(`Error loading chart ${chartId}:`, error);
                const chartContainer = document.getElementById(chartId);
                if (chartContainer) {
                    chartContainer.innerHTML = '<div class="alert alert-danger">Error loading chart. Please check the console and refresh the page.</div>';
                }
            }
        }

        function showLoadingState() {
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {

            });
        }

        window.addEventListener('resize', function() {
            const chartIds = [
                'sales-trend-chart', 'region-chart', 'product-chart',
                'retailer-chart', 'sales-method-chart', 'top-states-chart',
                'margin-chart', 'quarterly-chart', 'price-distribution-chart'
            ];
            chartIds.forEach(id => {
                const chartElement = document.getElementById(id);
                if (chartElement && typeof Plotly.Plots.resize === 'function') {
                    try {
                        Plotly.Plots.resize(id);
                    } catch(e) {
                        // Suppress resize errors if the plot doesn't exist on the current page
                    }
                }
            });
        });

        // ============================================
        // INTERACTIVE CHART FEATURES
        // ============================================

        // Chart Information Database
        const chartInfo = {
            'sales-trend-chart': {
                title: 'Monthly Sales Trend',
                description: 'Track sales performance over time to identify seasonal patterns and growth trends.',
                insights: [
                    'Visualizes total sales across all months',
                    'Helps identify peak sales periods',
                    'Shows year-over-year growth patterns',
                    'Useful for forecasting future sales'
                ],
                type: 'Time Series Analysis',
                bestFor: 'Tracking performance trends and identifying seasonality'
            },
            'region-chart': {
                title: 'Sales by Region',
                description: 'Compare sales performance across different geographic regions in the United States.',
                insights: [
                    'Shows regional sales distribution',
                    'Identifies top-performing regions',
                    'Helps optimize regional marketing strategies',
                    'Reveals geographic market opportunities'
                ],
                type: 'Geographic Distribution',
                bestFor: 'Regional performance comparison and market analysis'
            },
            'product-chart': {
                title: 'Product Performance',
                description: 'Analyze which product categories generate the most revenue and profit.',
                insights: [
                    'Compares performance across product lines',
                    'Identifies best-selling categories',
                    'Shows product revenue contribution',
                    'Guides inventory and production decisions'
                ],
                type: 'Category Analysis',
                bestFor: 'Product portfolio optimization and inventory planning'
            },
            'retailer-chart': {
                title: 'Retailer Performance',
                description: 'Evaluate sales performance across different retail partners.',
                insights: [
                    'Ranks retailers by sales volume',
                    'Identifies key retail partnerships',
                    'Shows retailer contribution to total sales',
                    'Helps allocate resources to top partners'
                ],
                type: 'Partner Analysis',
                bestFor: 'Retail partnership evaluation and resource allocation'
            },
            'sales-method-chart': {
                title: 'Sales by Channel',
                description: 'Compare performance across different sales channels (In-store, Outlet, Online).',
                insights: [
                    'Shows channel sales distribution',
                    'Identifies most profitable channels',
                    'Tracks omnichannel performance',
                    'Guides channel investment decisions'
                ],
                type: 'Channel Distribution',
                bestFor: 'Omnichannel strategy optimization'
            },
            'top-states-chart': {
                title: 'Top States by Sales',
                description: 'Identify which US states generate the highest sales volumes.',
                insights: [
                    'Ranks states by total sales',
                    'Shows geographic sales concentration',
                    'Identifies expansion opportunities',
                    'Guides regional marketing budgets'
                ],
                type: 'Geographic Ranking',
                bestFor: 'State-level market analysis and expansion planning'
            },
            'margin-chart': {
                title: 'Operating Margin Analysis',
                description: 'Analyze profitability margins across different dimensions.',
                insights: [
                    'Shows profit margin distribution',
                    'Identifies high-margin opportunities',
                    'Compares profitability across segments',
                    'Helps optimize pricing strategies'
                ],
                type: 'Profitability Analysis',
                bestFor: 'Margin optimization and pricing strategy'
            },
            'quarterly-chart': {
                title: 'Quarterly Performance',
                description: 'Track sales and profit performance by business quarters.',
                insights: [
                    'Shows quarterly trends and patterns',
                    'Compares quarter-over-quarter performance',
                    'Identifies seasonal business cycles',
                    'Supports quarterly planning and forecasting'
                ],
                type: 'Temporal Aggregation',
                bestFor: 'Quarterly reporting and business planning'
            },
            'price-distribution-chart': {
                title: 'Price Point Distribution',
                description: 'Analyze the distribution of products across different price ranges.',
                insights: [
                    'Shows price range distribution',
                    'Identifies sweet spot pricing',
                    'Reveals pricing strategy effectiveness',
                    'Guides product positioning decisions'
                ],
                type: 'Pricing Analysis',
                bestFor: 'Pricing strategy and product positioning'
            },
            // Customer Patterns Charts
            'sales-by-retailer-chart': {
                title: 'Sales by Retailer',
                description: 'Comprehensive analysis of sales performance across all retail partners.',
                insights: [
                    'Identifies top-performing retail partners',
                    'Shows retailer sales volume distribution',
                    'Helps prioritize retail relationships',
                    'Guides resource allocation to key partners'
                ],
                type: 'Retailer Analysis',
                bestFor: 'Partner performance evaluation and strategic planning'
            },
            'sales-by-sales-method-chart': {
                title: 'Sales by Method',
                description: 'Compare customer purchasing behavior across different sales channels.',
                insights: [
                    'Breaks down sales by In-store, Outlet, and Online',
                    'Identifies most popular shopping methods',
                    'Reveals customer channel preferences',
                    'Supports omnichannel strategy development'
                ],
                type: 'Channel Preference Analysis',
                bestFor: 'Customer behavior insights and channel optimization'
            },
            'sales-by-state-chart': {
                title: 'Geographic Sales Distribution',
                description: 'Interactive map showing sales performance across all 50 US states.',
                insights: [
                    'Visualizes sales concentration by state',
                    'Identifies high-value geographic markets',
                    'Reveals untapped market opportunities',
                    'Supports regional expansion planning'
                ],
                type: 'Geographic Heatmap',
                bestFor: 'Regional market analysis and expansion strategy'
            },
            'sales-by-day-of-week-chart': {
                title: 'Sales by Day of Week',
                description: 'Analyze customer purchasing patterns across different days of the week.',
                insights: [
                    'Shows which days generate most sales',
                    'Identifies weekly purchasing patterns',
                    'Helps optimize staffing and inventory',
                    'Guides promotional timing strategies'
                ],
                type: 'Temporal Pattern Analysis',
                bestFor: 'Operational planning and marketing campaign timing'
            },
            // Product Analysis Charts
            'product-revenue-profit-chart': {
                title: 'Product Revenue & Profit Comparison',
                description: 'Comprehensive view of revenue and profit performance across all product categories.',
                insights: [
                    'Compares revenue vs profit for each product line',
                    'Identifies most profitable product categories',
                    'Shows revenue-to-profit conversion rates',
                    'Guides product portfolio optimization'
                ],
                type: 'Dual-Axis Comparison',
                bestFor: 'Product profitability analysis and portfolio management'
            },
            'product-profitability-matrix-chart': {
                title: 'Product Profitability Matrix',
                description: 'Strategic matrix showing products positioned by units sold versus operating margin.',
                insights: [
                    'Visualizes high-volume vs high-margin products',
                    'Identifies star performers and underperformers',
                    'Reveals strategic product positioning',
                    'Supports pricing and inventory decisions'
                ],
                type: 'Scatter Plot Matrix',
                bestFor: 'Strategic product positioning and portfolio balance'
            },
            'product-by-sales-channel-chart': {
                title: 'Product Performance by Sales Channel',
                description: 'Breakdown of product sales across In-store, Outlet, and Online channels.',
                insights: [
                    'Shows which products sell best in each channel',
                    'Identifies channel-product fit opportunities',
                    'Reveals omnichannel performance patterns',
                    'Guides channel-specific product strategies'
                ],
                type: 'Stacked Bar Analysis',
                bestFor: 'Channel optimization and product placement strategy'
            },
            'product-sales-trend-chart': {
                title: 'Product Sales Trends Over Time',
                description: 'Time series analysis showing how each product category performs across months.',
                insights: [
                    'Tracks product performance trends monthly',
                    'Identifies seasonal product patterns',
                    'Shows which products are growing or declining',
                    'Supports demand forecasting by product'
                ],
                type: 'Multi-Line Time Series',
                bestFor: 'Product trend analysis and demand forecasting'
            },
            'product-price-distribution-chart': {
                title: 'Product Price Distribution',
                description: 'Distribution analysis of product pricing across all categories.',
                insights: [
                    'Shows price point distribution by product',
                    'Identifies premium vs budget products',
                    'Reveals pricing strategy effectiveness',
                    'Guides price positioning decisions'
                ],
                type: 'Distribution Analysis',
                bestFor: 'Pricing strategy and product tier positioning'
            },
            'product-regional-mix-chart': {
                title: 'Product Mix by Region',
                description: 'Regional breakdown showing which products perform best in each geographic area.',
                insights: [
                    'Shows regional product preferences',
                    'Identifies geographic product opportunities',
                    'Reveals regional demand patterns',
                    'Supports regional inventory planning'
                ],
                type: 'Regional Heatmap',
                bestFor: 'Regional product strategy and inventory allocation'
            }
        };

        // Initialize interactive charts after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to all interactive charts
            const interactiveCharts = document.querySelectorAll('.interactive-chart');

            interactiveCharts.forEach(chart => {
                // Add click event
                chart.addEventListener('click', function() {
                    const chartId = this.getAttribute('data-chart');
                    openChartModal(chartId);
                });

                // Add visual feedback on hover
                chart.addEventListener('mouseenter', function() {
                    this.classList.add('chart-hover-active');
                });

                chart.addEventListener('mouseleave', function() {
                    this.classList.remove('chart-hover-active');
                });
            });
        });

        // Open chart in modal with information
        function openChartModal(chartId) {
            const info = chartInfo[chartId];
            if (!info) return;

            // Update modal title
            document.getElementById('modalChartTitle').textContent = info.title;

            // Update chart info panel
            const infoContent = `
                <div class="mb-4">
                    <p class="text-muted">${info.description}</p>
                </div>

                <div class="mb-4">
                    <h6 class="fw-bold text-primary mb-2"><i class="fas fa-lightbulb me-2"></i>Key Insights</h6>
                    <ul class="list-unstyled ms-3">
                        ${info.insights.map(insight => `
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                ${insight}
                            </li>
                        `).join('')}
                    </ul>
                </div>

                <div class="mb-3">
                    <h6 class="fw-bold text-primary mb-2"><i class="fas fa-chart-pie me-2"></i>Chart Type</h6>
                    <p class="ms-3 mb-0"><span class="badge bg-info">${info.type}</span></p>
                </div>

                <div class="alert alert-light border">
                    <h6 class="fw-bold mb-2"><i class="fas fa-star me-2 text-warning"></i>Best For</h6>
                    <p class="mb-0 small">${info.bestFor}</p>
                </div>
            `;
            document.getElementById('chartInfoContent').innerHTML = infoContent;

            // Clone the chart to modal
            const originalChart = document.getElementById(chartId);
            const modalChartPreview = document.getElementById('modalChartPreview');

            if (originalChart) {
                // Clear previous content
                modalChartPreview.innerHTML = `<div id="modal-${chartId}" style="width: 100%; height: 500px;"></div>`;

                // Get the Plotly data from original chart
                setTimeout(() => {
                    const originalPlot = document.getElementById(chartId);
                    if (originalPlot && originalPlot.data && originalPlot.layout) {
                        const config = {
                            responsive: true,
                            displayModeBar: true,
                            displaylogo: false,
                            modeBarButtonsToAdd: ['toImage'],
                            toImageButtonOptions: {
                                format: 'png',
                                filename: chartId.replace('-chart', ''),
                                height: 800,
                                width: 1200,
                                scale: 2
                            }
                        };
                        Plotly.newPlot(`modal-${chartId}`, originalPlot.data, originalPlot.layout, config);
                    }
                }, 100);
            }

            // Show modal with animation
            const modal = new bootstrap.Modal(document.getElementById('chartModal'));
            modal.show();

            // Add animation class
            document.querySelector('.modal-content').classList.add('modal-zoom-in');
        }

        // Download chart function
        function downloadChart() {
            const modalContent = document.getElementById('modalChartPreview');
            const chartElement = modalContent.querySelector('[id^="modal-"]');

            if (chartElement) {
                Plotly.downloadImage(chartElement, {
                    format: 'png',
                    width: 1200,
                    height: 800,
                    filename: 'chart_export'
                });
            }
        }

        // Add entrance animation when charts load
        async function loadChart(apiUrl, chartId) {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const config = {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false,
                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                };

                await Plotly.newPlot(chartId, data.data, data.layout, config);

                // Add loaded animation
                const chartCard = document.querySelector(`[data-chart="${chartId}"]`);
                if (chartCard) {
                    chartCard.classList.add('chart-loaded');
                }
            } catch (error) {
                console.error(`Error loading chart ${chartId}:`, error);
                const chartContainer = document.getElementById(chartId);
                if (chartContainer) {
                    chartContainer.innerHTML = '<div class="alert alert-danger">Error loading chart. Please check the console and refresh the page.</div>';
                }
            }
        }
    </script>
</body>
</html>